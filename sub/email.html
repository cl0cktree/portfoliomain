<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- charset 설정 -->
    <meta charset="UTF-8">
    <!-- ie 호환성보기 무시 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 모바일을 위한 viewport설정 -->
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>문의메일</title>
    <link rel="stylesheet" type="text/css" href="../css/email.css">
    <script type="text/javascript" src="../js/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <!-- <script type="text/javascript" src="./js/email.min.js"></script> -->
    
  </head>
 
  <body>
     <script type="text/javascript">
        (function() {
            // https://dashboard.emailjs.com/admin/account
            emailjs.init({
              publicKey: "8stEfALCtlUyN_beC",
            });
        })();
    </script>
    <script>
    //document.getElementById('message').value='';
      var p_button;
      var h_button;
      var e_mail;
      var e_name;
      var e_title;
      var message_input;
      var popup_content;
      var dimm_filter;
      var popup_close;
      var vali;

        document.addEventListener("DOMContentLoaded", function(){
            e_mail =document.getElementById('email');
            e_name = document.getElementById('name');
            e_title = document.getElementById('title');
            message_input = document.getElementById('message');
            h_button = document.getElementById('h_button');
            dimm_filter = document.querySelector('.dimm_filter');
            p_button = document.getElementById('path_button');
            popup_close = document.getElementById('popup_close');
            
            function h_button_click(){
              popup_content = document.querySelector('.popup_content');
              vali = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
              console.log('dimm_filter = '+dimm_filter.className);

              dimm_filter.classList.add('on');
              if(e_mail.value==''){
                popup_content.querySelector('p').innerHTML+='<span>이메일을 입력 해주세요.</span><br>';
              };
              if((e_mail.value!=='')&&(!vali.test(e_mail.value))){
                popup_content.querySelector('p').innerHTML+='<span>이메일 주소가 형식에 맞지 않습니다.</span><br>';
              }
              if(e_name.value==''){
                popup_content.querySelector('p').innerHTML+='<span>이름을 입력 해주세요.</span><br>';
              };
              if(e_title.value==''){
                popup_content.querySelector('p').innerHTML+='<span>제목을 입력 해주세요.</span><br>';
              };
              if(message_input.value==''){
                popup_content.querySelector('p').innerHTML+='<span>내용을 입력 해주세요.</span><br>';
              };
              if(e_mail.value!=''&&e_name.value!=''&&e_title.value!=''&&message_input.value!=''&&vali.test(e_mail.value)){
                p_button.click();
                dimm_filter.classList.remove('on');
              };
            };
            popup_close.addEventListener('click',function(){
              dimm_filter.classList.remove('on');
              popup_content.querySelector('p').innerHTML='';
            });
            h_button.addEventListener('click',h_button_click);


            document.getElementById('mail_form').addEventListener('submit', function(event) {
                event.preventDefault();
                popup_content = document.querySelector('.popup_content');
                dimm_filter = document.querySelector('.dimm_filter');
                // these IDs from the previous steps
                emailjs.sendForm('clocktree', 'template_n3hysjz', this)
                    .then(() => {
                            // console.log('SUCCESS!');
                            dimm_filter.classList.add('on');
                            popup_content.querySelector('p').innerHTML+='<span>메일이 발송 되었습니다.</span><br>';
                            // alert('메일이 발송 되었습니다.');
                            e_mail.value='';
                            e_name.value='';
                            e_title.value='';
                            message_input.value='';
                        }, (error) => {
                            // console.log('FAILED...', error);
                            dimm_filter.classList.add('on');
                            popup_content.querySelector('p').innerHTML+='<span>메일 발송에 실패하였습니다.</span><br>';
                            // alert('메일 발송에 실패하였습니다.');
                        });
                
            });

        });
    </script>
    <form id="mail_form">
      <div class="contact_form" id="contact_form">
        <h3>이메일 문의</h3>
        <table id="mail_table" class="mail_table">
		      <tr>
            <th>이메일</th>
            <td>
              <input type="text" id="email" name="email" size="32" tabindex="1" placeholder="이메일 입력" aria-hidden="false" aria-label="이메일 입력" required/>
            </td>
          </tr>
          <tr>
            <th>보내는 사람</th>
            <td>
              <input type="text" id="name" name="name" size="32" tabindex="2" placeholder="이름 입력" aria-hidden="false" aria-label="이름 입력" required/>
            </td>
          </tr>
          <tr>
            <th>제목</th>
            <td>
              <input type="text" id="title" name="title" size="128" tabindex="3" placeholder="제목 입력" aria-hidden="false" aria-label="제목 입력" required/>
            </td>
          </tr>
          <tr>
            <th>내용</th>
            <td>
              <textarea id="message" name="message" rows="5" cols="26" tabindex="4" placeholder="내용 입력" aria-hidden="false" aria-label="내용 입력" required></textarea>
            </td>
          </tr>
          <tr>
            <td colspan="2" class="ps_1">(답변이 필요 하신 분은 꼭 연락처를 남겨주세요.)</td>
          </tr>
          <tr>
             <td colspan="2" style="padding-top:20px;">
              <button id="h_button" type="button" tabindex="5" aria-hidden="false" aria-label="문의하기 버튼" value="문의하기">
                문의하기
              </button>
              <button id="path_button" type="submit" tabindex="-1" aria-hidden="true" aria-label="문의하기 버튼" value="문의하기">
                문의하기
              </button>
            </td>
          </tr>
        </table>
      </div>
    </form>
    <div class="dimm_filter">
        <div class="popup_content">
            <p>
            </p>
            <button id="popup_close" type="button" tabindex="5" aria-hidden="false" aria-label="확인 버튼" value="확인">
                확인
            </button>
        </div>
    </div>
    <script>
    $(function(){
      document.getElementById('message').value='';
      var p_button = document.getElementById('path_button');
      var h_button = document.getElementById('h_button');
      var e_mail =document.getElementById('email');
      var h_mail = document.getElementById('h_mail');
      var e_name = document.getElementById('name');
      var h_name = document.getElementById('h_name');
      var message_input = document.getElementById('message');
      var hidden_input = document.getElementById('h_message');

      if(document.getElementById('mail_table')){
          var conbox_contentswrap = document.getElementById('mail_table');
          // var filter_conbox_contentswrap = document.getElementById('filter-conbox-contentswrap');
          var all_filter_conbox = document.getElementById('all-filter-conbox');
          
          $('#all-filter-conbox').find('[tabindex]').attr('tabindex','0');
          $('#all-filter-conbox').find('[tabindex]').eq(0).focus();
          
          $('#mail_table').on('keydown', function(e){
            console.log('email tabindex');

            var this_on_focus;

            var con_range = $('.all-filter-conbox, .conbox-contents-view').find('.filter-title-closebtn, .filter-conbox-contentswrap').find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, button:not([disabled]), submit, submit:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]');
            var con_first = con_range.eq(0);
            var con_last = con_range.eq(con_range.length-1);
            
            var focus_content = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, button:not([disabled]), submit, submit:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]';
            var conbox_content = conbox_contentswrap.querySelectorAll(focus_content);
            var first_content = conbox_contentswrap.querySelectorAll(focus_content)[0];
            var last_content = conbox_contentswrap.querySelectorAll(focus_content)[conbox_content.length-1];
            var first_content_0 = conbox_contentswrap.querySelectorAll(focus_content)[0];

            console.log('last_content = '+conbox_content.length);

            this_on_focus = document.activeElement;
            console.log('this_on_focus = '+this_on_focus);
            if ((e.keyCode===9 && !e.shiftKey)&&(this_on_focus==last_content)) {
              console.log('pop ride this_1');
              first_content.focus();
            }
            if((e.keyCode===9 && e.shiftKey)&&(this_on_focus==first_content)) {
              console.log('pop ride this_2');
              // last_content.focus();
              first_content.focus();
            }
            // e.preventDefault();
          });
      };
      // function conbox_contents(){ // 높은 단계의 모달로그 컨텐츠의 포커스 요소만 순회 함수 + esc 키 눌렀을 시 닫히기
      //   if(document.getElementById('mail_form')){
      //     var conbox_contentswrap = document.getElementById('mail_form');
      //     // var filter_conbox_contentswrap = document.getElementById('filter-conbox-contentswrap');
      //     var all_filter_conbox = document.getElementById('all-filter-conbox');
          
      //     $('#all-filter-conbox').find('[tabindex]').attr('tabindex','0');
      //     $('#all-filter-conbox').find('[tabindex]').eq(0).focus();
          
      //     $('mail_form').on('keydown', function(e){
      //       console.log('email tabindex');

      //       var this_on_focus;

      //       var con_range = $('.all-filter-conbox, .conbox-contents-view').find('.filter-title-closebtn, .filter-conbox-contentswrap').find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]');
      //       var con_first = con_range.eq(0);
      //       var con_last = con_range.eq(con_range.length-1);
            
      //       var focus_content = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]';
      //       var conbox_content = conbox_contentswrap.querySelectorAll(focus_content);
      //       var first_content = conbox_contentswrap.querySelectorAll(focus_content)[0];
      //       var last_content = conbox_contentswrap.querySelectorAll(focus_content)[conbox_content.length-1];

      //       console.log('last_content = '+conbox_content.length);

      //       this_on_focus = document.activeElement;
      //       if ((e.keyCode===9 && !e.shiftKey)&&(this_on_focus==last_content)) {
      //         console.log('pop ride this_1');
      //         first_content.focus();
      //       }
      //       if((e.keyCode===9 && e.shiftKey)&&(this_on_focus==first_content)) {
      //         console.log('pop ride this_2');
      //         last_content.focus();
      //       }
      //       e.preventDefault();
      //     });
      //     // conbox_contentswrap.addEventListener('keydown', function(e){
      //     //   var this_on_focus;

      //     //   var con_range = $('.all-filter-conbox, .conbox-contents-view').find('.filter-title-closebtn, .filter-conbox-contentswrap').find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]');
      //     //   var con_first = con_range.eq(0);
      //     //   var con_last = con_range.eq(con_range.length-1);
            
      //     //   var focus_content = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]';
      //     //   var conbox_content = conbox_contentswrap.querySelectorAll(focus_content);
      //     //   var first_content = conbox_contentswrap.querySelectorAll(focus_content)[0];
      //     //   var last_content = conbox_contentswrap.querySelectorAll(focus_content)[conbox_content.length-1];

      //     //   console.log('last_content = '+conbox_content.length);

      //     //   if (e.keyCode === 27){
      //     //     focus_still();
      //     //   }else{
      //     //     this_on_focus = document.activeElement;
      //     //     if ((e.keyCode===9 && !e.shiftKey)&&(this_on_focus==last_content)) {

      //     //       console.log('pop ride this_1');
      //     //       first_content.focus();
      //     //     }
      //     //     if((e.keyCode===9 && e.shiftKey)&&(this_on_focus==first_content)) {
      //     //       console.log('pop ride this_2');
      //     //       last_content.focus();
      //     //     }
      //     //   };
      //     //   e.preventDefault();
      //     // });

      //     // filter_conbox_contentswrap.addEventListener('keydown', function(e){
      //     //   var this_on_focus;

      //     //   var con_range = $('.all-filter-conbox, .conbox-contents-view').find('.filter-title-closebtn, .filter-conbox-contentswrap').find('a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]');
      //     //   var con_first = con_range.eq(0);
      //     //   var con_last = con_range.eq(con_range.length-1);
            
      //     //   var focus_content = 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button, button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]';
      //     //   var conbox_content = filter_conbox_contentswrap.querySelectorAll(focus_content);
      //     //   var first_content = filter_conbox_contentswrap.querySelectorAll(focus_content)[0];
      //     //   var last_content = filter_conbox_contentswrap.querySelectorAll(focus_content)[conbox_content.length-1];

      //     //   console.log('last_content = '+conbox_content.length);

      //     //   if (e.keyCode === 27){
      //     //     focus_still();
      //     //   }else{
      //     //     this_on_focus = document.activeElement;
      //     //     if ((e.keyCode===9 && !e.shiftKey)&&(this_on_focus==last_content)) {

      //     //       console.log('pop ride this_1');
      //     //       first_content.focus();
      //     //     }
      //     //     if((e.keyCode===9 && e.shiftKey)&&(this_on_focus==first_content)) {
      //     //       console.log('pop ride this_2');
      //     //       last_content.focus();
      //     //     }
      //     //     if (e.keyCode===13){
      //     //       console.log('in a this ='+$(this).attr('class'));
      //     //       if($(this).attr('class')==('.filter-title-closebtn')){
      //     //         $('.filter-title-closebtn').click();
      //     //       }else{
      //     //         var link_a = $('.filter-conbox-contentswrap').children('.filter-conbox-contents').find('.contents-view-img').find('a').attr('href');
      //     //         console.log('link_a = '+link_a);
      //     //         window.open("about:blank").location.href = link_a;
      //     //       };
      //     //     }
      //     //   };
      //     //   e.preventDefault();
      //     // });
      //   }
      // };
      // conbox_contents();
     });
    
    </script>
  </body>
 
</html>